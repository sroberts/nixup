# nixup

A declarative NixOS flake configuration for Framework 13 laptops with the Niri Wayland compositor.

## Features

- **Flake-based**: Reproducible builds with pinned dependencies
- **Home Manager**: Declarative user configuration
- **Framework 13 Support**: TLP power management, firmware updates, ambient light sensor
- **Niri Wayland Compositor**: Modern, scrollable tiling compositor with sensible defaults
- **LUKS Encryption**: Optional full-disk encryption
- **Tokyo Night Theme**: Consistent theming across terminal, editor, and desktop

## Project Structure

```
nixup/
├── flake.nix                   # Flake entry point
├── flake.lock                  # Pinned dependencies (auto-generated)
├── install.sh                  # Disk partitioning and installation
├── hosts/
│   └── framework/              # Framework 13 host configuration
│       ├── default.nix         # Main host config
│       ├── local.nix           # Machine-specific config (generated by install.sh)
│       └── hardware-configuration.nix
└── modules/
    ├── nixos/                  # System-level NixOS modules
    │   ├── base.nix            # Core system settings
    │   ├── niri.nix            # Niri compositor
    │   ├── applications.nix    # System packages
    │   └── framework.nix       # Framework hardware
    └── home/                   # Home Manager modules
        ├── default.nix         # Home Manager entry point
        ├── shell.nix           # Zsh, starship, CLI tools
        ├── git.nix             # Git configuration
        ├── niri.nix            # Niri user config, waybar, mako
        ├── ghostty.nix         # Terminal configuration
        └── yazi.nix            # File manager
```

## Requirements

- NixOS installation ISO (24.11 or later)
- UEFI boot mode
- Internet connection
- At least 20GB disk space

## Installation

### Fresh Install

1. Boot from the NixOS installation ISO
2. Clone this repository:
   ```bash
   nix-shell -p git
   git clone https://github.com/sroberts/nixup.git
   cd nixup
   ```
3. Run the installer:
   ```bash
   sudo ./install.sh
   ```
4. Follow the prompts:
   - Disk selection and swap size
   - LUKS encryption password (optional)
   - Username, full name, and password
   - System hostname
   - Git identity (optional)
5. Reboot into your new system

### Post-Installation

To make system changes, edit `/etc/nixos/` and apply:

```bash
sudo nixos-rebuild switch --flake /etc/nixos#framework
```

## Usage

### Rebuilding the System

```bash
# Apply changes
sudo nixos-rebuild switch --flake /etc/nixos#framework

# Test changes (reverts on reboot)
sudo nixos-rebuild test --flake /etc/nixos#framework

# Build without switching
sudo nixos-rebuild build --flake /etc/nixos#framework
```

### Updating

```bash
cd /etc/nixos

# Update flake inputs
nix flake update

# Rebuild with updates
sudo nixos-rebuild switch --flake .#framework
```

### Garbage Collection

```bash
# Remove old generations
sudo nix-collect-garbage -d

# Remove generations older than 7 days
sudo nix-collect-garbage --delete-older-than 7d
```

## Key Bindings

| Key | Action |
|-----|--------|
| `Super + Return` | Open terminal (Ghostty) |
| `Super + Space` | Application launcher (Fuzzel) |
| `Super + E` | File manager (Yazi in terminal) |
| `Super + Q` | Close window |
| `Super + L` | Lock screen |
| `Super + Escape` | Power menu |
| `Super + 1-9` | Switch to workspace |
| `Super + Shift + 1-9` | Move window to workspace |
| `Super + H/J/K/L` | Focus left/down/up/right |
| `Super + Shift + H/J/K/L` | Move window left/down/up/right |
| `Super + F` | Maximize column |
| `Super + Shift + F` | Fullscreen window |
| `Super + R` | Cycle column width presets |
| `Print` | Screenshot |

## Applications

### TUI-First Philosophy

This configuration prefers TUI applications where practical:

- **File Manager**: Yazi (`Super + E`)
- **Git**: Lazygit (`lg`)
- **Docker**: Lazydocker (`lzd`)
- **Kubernetes**: k9s (`kk`)
- **System Monitor**: btop (`top`)
- **Music**: ncspot

### Included Applications

- **Terminals**: Ghostty (default), Alacritty, Foot
- **Editors**: Neovim, Zed
- **Browsers**: Firefox, Chromium
- **Communication**: Signal, Discord, Zoom
- **Productivity**: LibreOffice, Obsidian, 1Password

## Shell Aliases

Modern CLI tool replacements are configured by default:

| Alias | Command |
|-------|---------|
| `ls` | `eza --icons` |
| `ll` | `eza -la --icons` |
| `cat` | `bat` |
| `grep` | `ripgrep` |
| `find` | `fd` |
| `top` | `btop` |
| `lg` | `lazygit` |
| `lzd` | `lazydocker` |

## Customization

### Machine-Specific Settings

Edit `hosts/framework/local.nix` to change:
- Username, full name, hostname
- Git identity (username and email)
- Password hash (generate with `mkpasswd -m sha-512`)

After editing, rebuild with `sudo nixos-rebuild switch --flake /etc/nixos#framework`.

### Adding Packages

Edit `modules/nixos/applications.nix` for system-wide packages.

### User Configuration

Edit files in `modules/home/` for user-level configuration managed by Home Manager.

### Adding a New Host

1. Copy `hosts/framework/` to `hosts/yourhostname/`
2. Update `flake.nix` to add the new configuration
3. Generate hardware config: `nixos-generate-config`
4. Customize `hosts/yourhostname/default.nix`

## Troubleshooting

### Niri Not Starting

Check the greetd logs:
```bash
journalctl -u greetd
```

### Audio Issues

Ensure PipeWire is running:
```bash
systemctl --user status pipewire
```

### Bluetooth Not Working

```bash
systemctl status bluetooth
bluetoothctl power on
```

## License

MIT

## Credits

- [Niri](https://github.com/YaLTeR/niri) - Wayland compositor
- [Home Manager](https://github.com/nix-community/home-manager) - User configuration
- [Tokyo Night](https://github.com/enkia/tokyo-night-vscode-theme) - Color scheme inspiration
